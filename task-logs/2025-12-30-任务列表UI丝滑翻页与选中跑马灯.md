# 项目任务日志：任务列表 UI 丝滑翻页与选中跑马灯

- 日期：2025-12-30
- 范围：`firmware` 端任务列表相关 UI（`TaskListState` / `TaskListViewState` / `DisplayController`）
- 目标：
  - 修复：旋钮翻页后返回上一页，第一页首条任务“看起来消失/缺一条”的问题
  - 修复：任务标题与右侧信息（TODAY/日期/标记等）发生覆盖的问题
  - 体验：参考 `OLED_UI` 的“丝滑”手感，实现任务列表**纵向丝滑翻页**与**选中行横向跑马灯**（仅选中行滚动），同时保留右侧信息栏

## 背景与问题

你反馈的现象聚焦在任务列表页：

1. 旋钮滚动到下一屏后，再返回第一页，第一页第一条任务不见了（或长期缺一条）。
2. 标题/任务文本与右侧信息互相覆盖（长标题时尤其明显）。
3. 翻页切换不够丝滑，缺少 OLED_UI 那种“过渡与惯性”的感觉。
4. 希望选中后每条任务能左右滚动显示完整标题（只对选中行生效）。

## 方案（修改前）

1. **统一与补齐 DisplayController 接口**：修复 `DisplayController.h/.cpp` 与 `TaskListState/ViewState` 的函数签名不一致、缺少实现导致的不可编译问题。
2. **引入/接入动画渲染**：
   - 纵向滚动：用 `UIAnimation` 的 `AnimatedValue` 对 `displayOffset` 做非线性缓动，绘制时用“浮点滚动偏移”计算每条卡片的 y 坐标，实现翻页过渡。
   - 滚动条：同步做缓动，避免跳变。
3. **选中行跑马灯（横向滚动）**：
   - 仅对选中行生效；未选中行继续截断显示，保证信息密度与稳定性。
   - 通过“绘制后遮罩 + 右侧信息重绘”的方式实现文字裁剪，确保不覆盖右侧信息。
4. **健壮性修复**：
   - 对动画滚动偏移做边界约束与状态重置，避免任务更新/快速翻页导致的空白/缺行。

## 预期效果

- 任务列表翻页时，条目上下滑动过渡自然，不再“跳页/闪一下”。
- 选中条目标题过长时自动左右滚动展示完整内容，且不覆盖右侧信息。
- 返回第一页不会再出现“第一页第一条没了/缺行”的视觉问题。

## 修改结果（修改后补充）

- 本次变更以“丝滑效果的基础设施”先行：
  - 新增 `firmware/include/UIAnimation.h` 与 `firmware/src/UIAnimation.cpp`（AnimatedValue/FrameRateController 等），为后续纵向缓动/跑马灯提供可复用底座。
  - `DisplayController` 保留并对齐 Animated 版本接口（便于后续在不破坏现有 UI 的前提下，逐步切换到动效渲染）。
- 说明：
  - 本日志中提到的“纵向丝滑翻页/选中跑马灯”目前尚未完整接入到 `TaskListState/TaskListViewState` 的渲染流程，后续可作为独立任务继续推进。
